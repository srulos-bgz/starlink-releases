<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data SDK Test - Starlink SDK</title>
    <link rel="stylesheet" href="css/starlink-sdk-test.css">
</head>
<body data-theme="data">
    <div class="container">
        <a href="index.html" class="back-link">← Back to SDK Test Suite</a>
        
        <div class="header">
            <h1>💾 Data SDK Test</h1>
            <p>UserDefaults and Keychain storage with secure data management</p>
        </div>
        
        <div class="test-panel">
            <!-- SDK Status Section -->
            <div class="status-section">
                <h3>
                    <span class="status-indicator status-warning" id="statusIndicator"></span>
                    SDK Status
                </h3>
                <div class="status-details" id="statusDetails">
                    Checking Data SDK availability...
                </div>
            </div>

            <!-- Available Methods Section -->
            <div id="methods-container"></div>

            <!-- Interactive Test Section -->
            <div class="test-section">
                <h3>🚀 Test Data Storage Methods</h3>
                
                <!-- UserDefaults Section -->
                <div class="form-group">
                    <h4>📝 UserDefaults Operations</h4>
                    <label for="udKey">Key</label>
                    <input type="text" id="udKey" placeholder="Enter storage key" value="test_key">
                    
                    <label for="udValue">Value</label>
                    <input type="text" id="udValue" placeholder="Enter value to store" value="Hello World">
                    
                    <label for="udType">Value Type</label>
                    <select id="udType">
                        <option value="string">String</option>
                        <option value="int">Integer</option>
                        <option value="bool">Boolean</option>
                        <option value="double">Double</option>
                        <option value="array">Array (JSON)</option>
                        <option value="object">Object (JSON)</option>
                    </select>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="testUserDefaultsSet()">💾 Set Value</button>
                        <button class="btn btn-primary" onclick="testUserDefaultsGet()">📖 Get Value</button>
                        <button class="btn btn-secondary" onclick="testUserDefaultsExists()">❓ Check Exists</button>
                        <button class="btn btn-secondary" onclick="testUserDefaultsRemove()">🗑️ Remove</button>
                        <button class="btn btn-secondary" onclick="testUserDefaultsGetAllKeys()">🔑 Get All Keys</button>
                    </div>
                </div>

                <!-- Keychain Section -->
                <div class="form-group">
                    <h4>🔐 Keychain Operations</h4>
                    <label for="kcKey">Key</label>
                    <input type="text" id="kcKey" placeholder="Enter keychain key" value="secure_token">
                    
                    <label for="kcValue">Value (String only)</label>
                    <input type="text" id="kcValue" placeholder="Enter secure value" value="secret_password_123">
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="testKeychainSet()">🔒 Set Secure Value</button>
                        <button class="btn btn-primary" onclick="testKeychainGet()">🔓 Get Secure Value</button>
                        <button class="btn btn-secondary" onclick="testKeychainExists()">❓ Check Exists</button>
                        <button class="btn btn-secondary" onclick="testKeychainDelete()">🗑️ Delete</button>
                        <button class="btn btn-secondary" onclick="testKeychainGetAllKeys()">🔑 Get All Keys</button>
                    </div>
                </div>

                <!-- Code Display Section -->
                <div class="code-section">
                    <h3>💻 Native API Calls</h3>
                    <div class="button-group">
                        <button class="btn-code code-toggle" id="udCodeBtn">Show UserDefaults Code</button>
                        <button class="btn-code code-toggle" id="kcCodeBtn">Show Keychain Code</button>
                    </div>
                    <div id="udCode" style="display: none;"></div>
                    <div id="kcCode" style="display: none;"></div>
                </div>

                <div id="result-area" class="result-area">
                    Results will appear here...
                </div>
            </div>
        </div>
    </div>

    <script src="js/starlink-sdk-test.js"></script>
    <script>
        // SDK-specific configuration
        const SDK_CONFIG = {
            moduleName: 'Data',
            methods: [
                // UserDefaults methods
                { signature: 'userDefaults.set(key, value)', description: 'Store a value in UserDefaults', autoCall: false },
                { signature: 'userDefaults.get(key)', description: 'Get a value from UserDefaults', autoCall: false },
                { signature: 'userDefaults.getString(key)', description: 'Get a string value from UserDefaults', autoCall: false },
                { signature: 'userDefaults.getInt(key)', description: 'Get an integer value from UserDefaults', autoCall: false },
                { signature: 'userDefaults.getBool(key)', description: 'Get a boolean value from UserDefaults', autoCall: false },
                { signature: 'userDefaults.getDouble(key)', description: 'Get a double value from UserDefaults', autoCall: false },
                { signature: 'userDefaults.getArray(key)', description: 'Get an array value from UserDefaults', autoCall: false },
                { signature: 'userDefaults.getDictionary(key)', description: 'Get a dictionary/object value from UserDefaults', autoCall: false },
                { signature: 'userDefaults.remove(key)', description: 'Remove a value from UserDefaults', autoCall: false },
                { signature: 'userDefaults.exists(key)', description: 'Check if a key exists in UserDefaults', autoCall: false },
                { signature: 'userDefaults.getAllKeys()', description: 'Get all UserDefaults keys', autoCall: false },
                // Keychain methods
                { signature: 'keychain.set(key, value)', description: 'Store a secure string value in Keychain', autoCall: false },
                { signature: 'keychain.get(key)', description: 'Get a secure string value from Keychain', autoCall: false },
                { signature: 'keychain.delete(key)', description: 'Delete a value from Keychain', autoCall: false },
                { signature: 'keychain.exists(key)', description: 'Check if a key exists in Keychain', autoCall: false },
                { signature: 'keychain.getAllKeys()', description: 'Get all Keychain keys', autoCall: false }
            ],
            autoRun: false,
            interactive: true
        };

        // Initialize components
        const sdkStatus = new StarlinkSDK.StarlinkSDKStatus(SDK_CONFIG.moduleName);
        const methodsDisplay = new StarlinkSDK.MethodsDisplay();
        const resultDisplay = new StarlinkSDK.ResultDisplay();
        const codeDisplay = new StarlinkSDK.CodeDisplay();

        // Page initialization
        document.addEventListener('DOMContentLoaded', function() {
            const isAvailable = sdkStatus.check();
            setupMethods();
            if (isAvailable) {
                setupInteractive();
            }
        });

        function setupMethods() {
            SDK_CONFIG.methods.forEach(method => {
                methodsDisplay.addMethod(method.signature, method.description, method.autoCall || false);
            });
            methodsDisplay.render();
        }

        function setupInteractive() {
            codeDisplay.register('udCodeBtn', 'udCode', 
                StarlinkSDK.StarlinkUtils.createCodeBlock(`// UserDefaults Examples
await window.Starlink.Data.userDefaults.set('key', 'value');
const value = await window.Starlink.Data.userDefaults.get('key');
const exists = await window.Starlink.Data.userDefaults.exists('key');
await window.Starlink.Data.userDefaults.remove('key');
const allKeys = await window.Starlink.Data.userDefaults.getAllKeys();`)
            );
            
            codeDisplay.register('kcCodeBtn', 'kcCode', 
                StarlinkSDK.StarlinkUtils.createCodeBlock(`// Keychain Examples
await window.Starlink.Data.keychain.set('secure_key', 'secure_value');
const secureValue = await window.Starlink.Data.keychain.get('secure_key');
const exists = await window.Starlink.Data.keychain.exists('secure_key');
await window.Starlink.Data.keychain.delete('secure_key');
const allKeys = await window.Starlink.Data.keychain.getAllKeys();`)
            );
        }

        function parseValue(value, type) {
            switch (type) {
                case 'int': return parseInt(value) || 0;
                case 'bool': return value.toLowerCase() === 'true';
                case 'double': return parseFloat(value) || 0.0;
                case 'array': 
                    try { return JSON.parse(value); } 
                    catch { return value.split(',').map(s => s.trim()); }
                case 'object': 
                    try { return JSON.parse(value); } 
                    catch { return {value}; }
                default: return value;
            }
        }

        async function testUserDefaultsSet() {
            const key = document.getElementById('udKey').value.trim();
            const value = document.getElementById('udValue').value.trim();
            const type = document.getElementById('udType').value;
            
            if (!key || !value) {
                resultDisplay.showError('❌ Error: Key and value are required');
                return;
            }

            if (!window.Starlink?.Data?.userDefaults) {
                resultDisplay.showError('❌ Error: Starlink Data bridge not available');
                return;
            }

            try {
                const parsedValue = parseValue(value, type);
                const result = await window.Starlink.Data.userDefaults.set(key, parsedValue);
                
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    'Data.userDefaults.set', {key, value: parsedValue, type}, result, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.userDefaults.set', {key, value, type}, error.message, false
                ));
            }
        }

        async function testUserDefaultsGet() {
            const key = document.getElementById('udKey').value.trim();
            const type = document.getElementById('udType').value;
            
            if (!key) {
                resultDisplay.showError('❌ Error: Key is required');
                return;
            }

            if (!window.Starlink?.Data?.userDefaults) {
                resultDisplay.showError('❌ Error: Starlink Data bridge not available');
                return;
            }

            try {
                let result;
                switch (type) {
                    case 'string': result = await window.Starlink.Data.userDefaults.getString(key); break;
                    case 'int': result = await window.Starlink.Data.userDefaults.getInt(key); break;
                    case 'bool': result = await window.Starlink.Data.userDefaults.getBool(key); break;
                    case 'double': result = await window.Starlink.Data.userDefaults.getDouble(key); break;
                    case 'array': result = await window.Starlink.Data.userDefaults.getArray(key); break;
                    case 'object': result = await window.Starlink.Data.userDefaults.getDictionary(key); break;
                    default: result = await window.Starlink.Data.userDefaults.get(key);
                }
                
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    `Data.userDefaults.get${type === 'string' ? 'String' : type === 'object' ? 'Dictionary' : type.charAt(0).toUpperCase() + type.slice(1)}`, 
                    {key, type}, result, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.userDefaults.get', {key, type}, error.message, false
                ));
            }
        }

        async function testUserDefaultsExists() {
            const key = document.getElementById('udKey').value.trim();
            if (!key) {
                resultDisplay.showError('❌ Error: Key is required');
                return;
            }

            try {
                const result = await window.Starlink.Data.userDefaults.exists(key);
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    'Data.userDefaults.exists', {key}, result, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.userDefaults.exists', {key}, error.message, false
                ));
            }
        }

        async function testUserDefaultsRemove() {
            const key = document.getElementById('udKey').value.trim();
            if (!key) {
                resultDisplay.showError('❌ Error: Key is required');
                return;
            }

            try {
                const result = await window.Starlink.Data.userDefaults.remove(key);
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    'Data.userDefaults.remove', {key}, result, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.userDefaults.remove', {key}, error.message, false
                ));
            }
        }

        async function testUserDefaultsGetAllKeys() {
            try {
                const result = await window.Starlink.Data.userDefaults.getAllKeys();
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    'Data.userDefaults.getAllKeys', {}, result, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.userDefaults.getAllKeys', {}, error.message, false
                ));
            }
        }

        async function testKeychainSet() {
            const key = document.getElementById('kcKey').value.trim();
            const value = document.getElementById('kcValue').value.trim();
            
            if (!key || !value) {
                resultDisplay.showError('❌ Error: Key and value are required');
                return;
            }

            try {
                const result = await window.Starlink.Data.keychain.set(key, value);
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    'Data.keychain.set', {key, value: '***SECURE***'}, result, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.keychain.set', {key, value: '***SECURE***'}, error.message, false
                ));
            }
        }

        async function testKeychainGet() {
            const key = document.getElementById('kcKey').value.trim();
            if (!key) {
                resultDisplay.showError('❌ Error: Key is required');
                return;
            }

            try {
                const result = await window.Starlink.Data.keychain.get(key);
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    'Data.keychain.get', {key}, result ? '***SECURE_VALUE_RETRIEVED***' : null, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.keychain.get', {key}, error.message, false
                ));
            }
        }

        async function testKeychainExists() {
            const key = document.getElementById('kcKey').value.trim();
            if (!key) {
                resultDisplay.showError('❌ Error: Key is required');
                return;
            }

            try {
                const result = await window.Starlink.Data.keychain.exists(key);
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    'Data.keychain.exists', {key}, result, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.keychain.exists', {key}, error.message, false
                ));
            }
        }

        async function testKeychainDelete() {
            const key = document.getElementById('kcKey').value.trim();
            if (!key) {
                resultDisplay.showError('❌ Error: Key is required');
                return;
            }

            try {
                const result = await window.Starlink.Data.keychain.delete(key);
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    'Data.keychain.delete', {key}, result, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.keychain.delete', {key}, error.message, false
                ));
            }
        }

        async function testKeychainGetAllKeys() {
            try {
                const result = await window.Starlink.Data.keychain.getAllKeys();
                resultDisplay.showSuccess(resultDisplay.formatApiResult(
                    'Data.keychain.getAllKeys', {}, result, true
                ));
            } catch (error) {
                resultDisplay.showError(resultDisplay.formatApiResult(
                    'Data.keychain.getAllKeys', {}, error.message, false
                ));
            }
        }
    </script>
</body>
</html>
